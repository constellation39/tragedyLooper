{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "$ref": "#/definitions/EventHistoryCondition",
    "definitions": {
        "EventHistoryCondition": {
            "properties": {
                "event_type": {
                    "enum": [
                        "GAME_EVENT_TYPE_UNSPECIFIED",
                        0,
                        "GAME_EVENT_TYPE_CHARACTER_MOVED",
                        1,
                        "GAME_EVENT_TYPE_PARANOIA_ADJUSTED",
                        2,
                        "GAME_EVENT_TYPE_GOODWILL_ADJUSTED",
                        3,
                        "GAME_EVENT_TYPE_INTRIGUE_ADJUSTED",
                        4,
                        "GAME_EVENT_TYPE_INCIDENT_TRIGGERED",
                        5,
                        "GAME_EVENT_TYPE_INCIDENT_PREVENTED",
                        6,
                        "GAME_EVENT_TYPE_ROLE_REVEALED",
                        7,
                        "GAME_EVENT_TYPE_ABILITY_GRANTED",
                        8,
                        "GAME_EVENT_TYPE_CHOICE_REQUIRED",
                        9,
                        "GAME_EVENT_TYPE_LOOP_WIN",
                        10,
                        "GAME_EVENT_TYPE_LOOP_LOSS",
                        11,
                        "GAME_EVENT_TYPE_FIRST_GUESS_MADE",
                        12,
                        "GAME_EVENT_TYPE_FINAL_GUESS_MADE",
                        13,
                        "GAME_EVENT_TYPE_GOODWILL_REFUSAL_TEST",
                        14,
                        "GAME_EVENT_TYPE_LOOP_OVER",
                        15,
                        "GAME_EVENT_TYPE_DAY_ADVANCED",
                        16,
                        "GAME_EVENT_TYPE_TRAGEDY_TRIGGERED",
                        17,
                        "GAME_EVENT_TYPE_LOOP_RESET",
                        18,
                        "GAME_EVENT_TYPE_TRAIT_ADDED",
                        19,
                        "GAME_EVENT_TYPE_TRAIT_REMOVED",
                        20,
                        "GAME_EVENT_TYPE_CARD_PLAYED",
                        21,
                        "GAME_EVENT_TYPE_CARD_REVEALED",
                        22,
                        "GAME_EVENT_TYPE_GAME_ENDED",
                        23,
                        "GAME_EVENT_TYPE_PLAYER_ACTION",
                        24
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Game Event Type",
                    "description": "游戏事件类型（用于能力触发器过滤）"
                },
                "lookback_days": {
                    "type": "integer",
                    "description": "How many days into the past to look. 0 means today, 1 means today and yesterday, etc."
                },
                "event_target": {
                    "$ref": "#/definitions/tragedylooper.v1.TargetSelector",
                    "additionalProperties": true,
                    "description": "Optional: Further filter by the character involved in the event."
                },
                "count": {
                    "type": "integer",
                    "description": "The number of times the event must have occurred."
                },
                "comparator": {
                    "enum": [
                        "COMPARATOR_UNSPECIFIED",
                        0,
                        "EQUAL_TO",
                        1,
                        "GREATER_THAN_OR_EQUAL_TO",
                        2,
                        "LESS_THAN_OR_EQUAL_TO",
                        3
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Comparator",
                    "description": "The comparator for the count."
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Event History Condition",
            "description": "EventHistoryCondition defines a condition based on past game events."
        },
        "tragedylooper.v1.Empty": {
            "additionalProperties": true,
            "type": "object",
            "title": "Empty",
            "description": "Empty is a placeholder for messages that have no data."
        },
        "tragedylooper.v1.TargetSelector": {
            "properties": {
                "specific_character": {
                    "type": "integer",
                    "description": "A specific character by ID."
                },
                "triggering_character": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "The character that triggered the event."
                },
                "culprit": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "The culprit of the event."
                },
                "victim": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "The victim of the event."
                },
                "character_with_role_id": {
                    "type": "integer",
                    "description": "Any character with a specific role."
                },
                "all_characters_at_location": {
                    "enum": [
                        "LOCATION_TYPE_UNSPECIFIED",
                        0,
                        "LOCATION_TYPE_HOSPITAL",
                        1,
                        "LOCATION_TYPE_SHRINE",
                        2,
                        "LOCATION_TYPE_CITY",
                        3,
                        "LOCATION_TYPE_SCHOOL",
                        4
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Location Type",
                    "description": "地点类型（也可通过LocationConfig扩展）"
                },
                "action_user": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "The user of the action (card or ability)."
                },
                "action_target": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "The target of the action (card or ability)."
                },
                "all_characters": {
                    "$ref": "#/definitions/tragedylooper.v1.Empty",
                    "additionalProperties": true,
                    "description": "All characters."
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Target Selector",
            "description": "TargetSelector defines a dynamic target for conditions or effects. It uses a oneof to ensure that only one type of selector can be set at a time."
        }
    }
}