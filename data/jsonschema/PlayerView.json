{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "$ref": "#/definitions/PlayerView",
    "definitions": {
        "PlayerView": {
            "properties": {
                "game_id": {
                    "type": "string",
                    "description": "游戏唯一ID"
                },
                "script_id": {
                    "type": "integer",
                    "description": "剧本ID"
                },
                "characters": {
                    "additionalProperties": {
                        "$ref": "#/definitions/v1.PlayerViewCharacter",
                        "additionalProperties": true
                    },
                    "type": "object",
                    "description": "玩家视角下的角色状态映射 (隐藏身份已移除)"
                },
                "players": {
                    "additionalProperties": {
                        "$ref": "#/definitions/v1.PlayerViewPlayer",
                        "additionalProperties": true
                    },
                    "type": "object",
                    "description": "玩家视角下的其他玩家信息 (手牌等可能隐藏)"
                },
                "current_day": {
                    "type": "integer",
                    "description": "当前天数"
                },
                "current_loop": {
                    "type": "integer",
                    "description": "当前循环数"
                },
                "current_phase": {
                    "enum": [
                        "GAME_PHASE_UNSPECIFIED",
                        0,
                        "SETUP",
                        1,
                        "MASTERMIND_SETUP",
                        2,
                        "LOOP_START",
                        3,
                        "DAY_START",
                        4,
                        "CARD_PLAY",
                        5,
                        "CARD_REVEAL",
                        6,
                        "CARD_RESOLVE",
                        7,
                        "ABILITIES",
                        8,
                        "INCIDENTS",
                        9,
                        "DAY_END",
                        10,
                        "LOOP_END",
                        11,
                        "PROTAGONIST_GUESS",
                        12,
                        "GAME_OVER",
                        13
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Game Phase",
                    "description": "游戏阶段"
                },
                "active_tragedies": {
                    "additionalProperties": {
                        "type": "boolean"
                    },
                    "type": "object",
                    "description": "已触发的悲剧"
                },
                "prevented_tragedies": {
                    "additionalProperties": {
                        "type": "boolean"
                    },
                    "type": "object",
                    "description": "已阻止的悲剧"
                },
                "your_hand": {
                    "items": {
                        "$ref": "#/definitions/v1.Card"
                    },
                    "type": "array",
                    "description": "当前玩家的手牌列表"
                },
                "your_deductions": {
                    "$ref": "#/definitions/v1.PlayerDeductionKnowledge",
                    "additionalProperties": true,
                    "description": "当前玩家的推理知识"
                },
                "public_events": {
                    "items": {
                        "$ref": "#/definitions/v1.GameEvent"
                    },
                    "type": "array",
                    "description": "对所有玩家公开的事件日志"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Player View",
            "description": "玩家视角下的游戏状态（用于向特定玩家展示信息，隐藏其他玩家的秘密信息）"
        },
        "v1.Ability": {
            "properties": {
                "id": {
                    "type": "integer",
                    "description": "能力ID，关联到AbilityConfig"
                },
                "used_this_loop": {
                    "type": "boolean",
                    "description": "运行时状态：本循环是否已使用"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Ability"
        },
        "v1.Card": {
            "properties": {
                "id": {
                    "type": "integer",
                    "description": "卡牌ID，关联到CardConfig"
                },
                "used_this_loop": {
                    "type": "boolean",
                    "description": "运行时状态：本循环是否已使用"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Card",
            "description": "卡牌运行时实例"
        },
        "v1.CharacterRule": {
            "properties": {
                "name": {
                    "type": "string",
                    "description": "规则名称"
                },
                "description": {
                    "type": "string",
                    "description": "规则描述"
                },
                "trigger": {
                    "enum": [
                        "TRIGGER_TYPE_UNSPECIFIED",
                        0,
                        "ON_GAME_SETUP",
                        1,
                        "ON_LOOP_START",
                        2,
                        "ON_DAY_START",
                        3,
                        "ON_PHASE_START",
                        4,
                        "ON_PHASE_END",
                        5,
                        "ON_GAME_EVENT",
                        6,
                        "PASSIVE",
                        7,
                        "ON_GUESS_MADE",
                        8,
                        "ON_GAME_END",
                        9
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Trigger Type",
                    "description": "触发器类型（能力或规则何时触发）"
                },
                "turf_selection_effect": {
                    "$ref": "#/definitions/v1.TurfSelectionEffect",
                    "additionalProperties": true,
                    "description": "地盘选择效果"
                },
                "delayed_entry_effect": {
                    "$ref": "#/definitions/v1.DelayedEntryEffect",
                    "additionalProperties": true,
                    "description": "延迟登场效果"
                },
                "special_movement_rule": {
                    "$ref": "#/definitions/v1.SpecialMovementRule",
                    "additionalProperties": true,
                    "description": "特殊移动规则"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Character Rule",
            "description": "角色特殊规则"
        },
        "v1.DelayedEntryEffect": {
            "properties": {
                "day_of_entry": {
                    "type": "integer",
                    "description": "登场日期"
                },
                "entry_location": {
                    "enum": [
                        "LOCATION_TYPE_UNSPECIFIED",
                        0,
                        "HOSPITAL",
                        1,
                        "SHRINE",
                        2,
                        "CITY",
                        3,
                        "SCHOOL",
                        4
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Location Type",
                    "description": "地点类型（也可通过LocationConfig扩展）"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Delayed Entry Effect",
            "description": "延迟登场效果"
        },
        "v1.GameEvent": {
            "properties": {
                "type": {
                    "enum": [
                        "GAME_EVENT_TYPE_UNSPECIFIED",
                        0,
                        "CHARACTER_MOVED",
                        1,
                        "STAT_ADJUSTED",
                        2,
                        "INCIDENT_TRIGGERED",
                        3,
                        "ROLE_REVEALED",
                        4,
                        "CHARACTER_DIED",
                        5,
                        "ABILITY_USED",
                        6,
                        "CARD_PLAYED",
                        7,
                        "DAY_ADVANCED",
                        8,
                        "LOOP_RESET",
                        9
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Game Event Type",
                    "description": "游戏事件类型（用于能力触发器过滤）"
                },
                "payload": {
                    "properties": {
                        "type_url": {
                            "type": "string",
                            "description": "A URL/resource name that uniquely identifies the type of the serialized protocol buffer message. This string must contain at least one \"/\" character. The last segment of the URL's path must represent the fully qualified name of the type (as in `path/google.protobuf.Duration`). The name should be in a canonical form (e.g., leading \".\" is not accepted). In practice, teams usually precompile into the binary all types that they expect it to use in the context of Any. However, for URLs which use the scheme `http`, `https`, or no scheme, one can optionally set up a type server that maps type URLs to message definitions as follows: * If no scheme is provided, `https` is assumed. * An HTTP GET on the URL must yield a [google.protobuf.Type][]   value in binary format, or produce an error. * Applications are allowed to cache lookup results based on the   URL, or have them precompiled into a binary to avoid any   lookup. Therefore, binary compatibility needs to be preserved   on changes to types. (Use versioned type names to manage   breaking changes.) Note: this functionality is not currently available in the official protobuf release, and it is not used for type URLs beginning with type.googleapis.com. As of May 2023, there are no widely used type server implementations and no plans to implement one. Schemes other than `http`, `https` (or the empty scheme) might be used with implementation specific semantics."
                        },
                        "value": {
                            "type": "string",
                            "description": "Must be a valid serialized protocol buffer of the above specified type.",
                            "format": "binary",
                            "binaryEncoding": "base64"
                        }
                    },
                    "additionalProperties": true,
                    "type": "object",
                    "description": "事件的具体负载"
                },
                "timestamp": {
                    "type": "string",
                    "description": "事件发生的时间戳",
                    "format": "date-time"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Game Event",
            "description": "GameEvent 表示游戏中发生的事件。"
        },
        "v1.PlayerDeductionKnowledge": {
            "properties": {
                "guessed_roles": {
                    "additionalProperties": {
                        "enum": [
                            "ROLE_TYPE_UNSPECIFIED",
                            0,
                            "PERSON",
                            1,
                            "KILLER",
                            2,
                            "BRAIN",
                            3,
                            "KEY_PERSON",
                            4,
                            "CULTIST",
                            5,
                            "FRIEND",
                            6,
                            "LOVED_ONE",
                            7,
                            "CONSPIRACY_THEORIST",
                            8,
                            "SERIAL_KILLER",
                            9,
                            "FACTOR",
                            10,
                            "WITCH",
                            11,
                            "TIME_TRAVELER",
                            12
                        ],
                        "oneOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "integer"
                            }
                        ],
                        "title": "Role Type",
                        "description": "角色身份类型"
                    },
                    "type": "object",
                    "description": "对角色身份的猜测，键为 character_id"
                },
                "clues": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "收集到的线索列表"
                },
                "theories": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "推理出的理论列表"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Player Deduction Knowledge",
            "description": "主角的推理知识"
        },
        "v1.PlayerViewCharacter": {
            "properties": {
                "id": {
                    "type": "integer",
                    "description": "角色唯一ID"
                },
                "name": {
                    "type": "string",
                    "description": "角色名称"
                },
                "traits": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "角色特征"
                },
                "current_location": {
                    "enum": [
                        "LOCATION_TYPE_UNSPECIFIED",
                        0,
                        "HOSPITAL",
                        1,
                        "SHRINE",
                        2,
                        "CITY",
                        3,
                        "SCHOOL",
                        4
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Location Type",
                    "description": "地点类型（也可通过LocationConfig扩展）"
                },
                "paranoia": {
                    "type": "integer",
                    "description": "妄想值"
                },
                "goodwill": {
                    "type": "integer",
                    "description": "好感值"
                },
                "intrigue": {
                    "type": "integer",
                    "description": "阴谋值"
                },
                "abilities": {
                    "items": {
                        "$ref": "#/definitions/v1.Ability"
                    },
                    "type": "array",
                    "description": "角色拥有的能力列表"
                },
                "is_alive": {
                    "type": "boolean",
                    "description": "角色是否存活"
                },
                "in_panic_mode": {
                    "type": "boolean",
                    "description": "是否处于恐慌模式"
                },
                "rules": {
                    "items": {
                        "$ref": "#/definitions/v1.CharacterRule"
                    },
                    "type": "array",
                    "description": "角色特有规则"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Player View Character",
            "description": "玩家视角下的角色信息（不包含隐藏身份）"
        },
        "v1.PlayerViewPlayer": {
            "properties": {
                "id": {
                    "type": "integer",
                    "description": "玩家唯一ID"
                },
                "name": {
                    "type": "string",
                    "description": "玩家名称"
                },
                "role": {
                    "enum": [
                        "PLAYER_ROLE_UNSPECIFIED",
                        0,
                        "MASTERMIND",
                        1,
                        "PROTAGONIST",
                        2
                    ],
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "integer"
                        }
                    ],
                    "title": "Player Role",
                    "description": "玩家角色"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Player View Player",
            "description": "玩家视角下的其他玩家信息（不包含私密数据）"
        },
        "v1.SpecialMovementRule": {
            "properties": {
                "restricted_locations": {
                    "items": {
                        "enum": [
                            "LOCATION_TYPE_UNSPECIFIED",
                            0,
                            "HOSPITAL",
                            1,
                            "SHRINE",
                            2,
                            "CITY",
                            3,
                            "SCHOOL",
                            4
                        ]
                    },
                    "type": "array",
                    "title": "Location Type",
                    "description": "地点类型（也可通过LocationConfig扩展）"
                },
                "description": {
                    "type": "string",
                    "description": "规则描述"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Special Movement Rule",
            "description": "特殊移动规则"
        },
        "v1.TurfSelectionEffect": {
            "properties": {
                "possible_locations": {
                    "items": {
                        "enum": [
                            "LOCATION_TYPE_UNSPECIFIED",
                            0,
                            "HOSPITAL",
                            1,
                            "SHRINE",
                            2,
                            "CITY",
                            3,
                            "SCHOOL",
                            4
                        ]
                    },
                    "type": "array",
                    "title": "Location Type",
                    "description": "地点类型（也可通过LocationConfig扩展）"
                },
                "prompt": {
                    "type": "string",
                    "description": "给玩家的提示信息"
                }
            },
            "additionalProperties": true,
            "type": "object",
            "title": "Turf Selection Effect",
            "description": "地盘选择效果"
        }
    }
}