syntax = "proto3";

package tragedylooper.v1;


import "validate/validate.proto";
import "tragedylooper/v1/enums.proto";
import "tragedylooper/v1/incident.proto";
import "tragedylooper/v1/character.proto";
import "tragedylooper/v1/card.proto";
import "tragedylooper/v1/ability.proto";

option go_package = "github.com/constellation39/tragedyLooper/pkg/proto/v1";

// Script defines the configuration for a tragedy looper script.
message ScriptConfig {
  // The unique identifier for the script.
  int32 id = 1 [ (validate.rules).int32.gt = 0 ];
  // The name of the script.
  string name = 2 [ (validate.rules).string.min_len = 1 ];
  // A description of the script.
  string description = 3;

  // Main plot configurations. ID range: 1000-1999
  map<int32, PlotConfig> main_plots = 4 [ (validate.rules).map.keys.int32 = { gte: 1000, lt: 2000 } ];
  // Sub plot configurations. ID range: 2000-2999
  map<int32, PlotConfig> sub_plots = 5 [ (validate.rules).map.keys.int32 = { gte: 2000, lt: 3000 } ];

  // Role configurations. ID range: 3000-3999
  map<int32, RoleConfig> roles = 6 [ (validate.rules).map.keys.int32 = { gte: 3000, lt: 4000 } ];

  // Incident configurations. ID range: 4000-4999
  map<int32, IncidentConfig> incidents = 7 [ (validate.rules).map.keys.int32 = { gte: 4000, lt: 5000 } ];

  // Character configurations. ID range: 5000-5999
  map<int32, CharacterConfig> characters = 8 [ (validate.rules).map.keys.int32 = { gte: 5000, lt: 6000 } ];

  // Mastermind card configurations. ID range: 6000-6999
  map<int32, CardConfig> mastermind_cards = 9 [ (validate.rules).map.keys.int32 = { gte: 6000, lt: 7000 } ];
  // Protagonist card configurations. ID range: 7000-7999
  map<int32, CardConfig> protagonist_cards = 10 [ (validate.rules).map.keys.int32 = { gte: 7000, lt: 8000 } ];

  // A map of script configurations. ID range: 8000-8999
  map<int32, ScriptModel> script_models = 11 [ (validate.rules).map.keys.int32 = { gte: 8000, lt: 9000 } ];
}



message ScriptSet {
  string name = 1;
  int32 number = 2;
}

message DifficultySet {
  int32 number_of_loops = 1;
  int32 difficulty = 2;
}

message IncidentInstance {
  int32 day = 1;
  string incident = 2;
  string culprit = 3;
}

message CastRole {
    string role = 1;
    map<string, string> extra_info = 2;
}

message CastAssignment {
    oneof assignment {
        string role_name = 1;
        CastRole role_with_extra = 2;
    }
}

message ScriptMetadata {
  string title = 1;
  string creator = 2;
  repeated ScriptSet set = 3;
  string tragedy_set = 4;
  int32 days_per_loop = 5;
  repeated DifficultySet difficulty_sets = 6;
  repeated string main_plot = 7;
  repeated string sub_plots = 8;
  map<string, CastAssignment> cast = 9;
  repeated IncidentInstance incidents = 10;
  string victory_conditions = 11;
  string story = 12;
  string mastermind_hints = 13;
  string description = 14;
  repeated string special_rules = 15;
  string source = 16;
}

// ScriptModel defines the configuration for a specific script.
message ScriptModel {
  int32 id = 1 [ (validate.rules).int32.gt = 0 ];
  // Private information for the script.
  PrivateInfo private_info = 2;
  // Public information for the script.
  PublicInfo public_info = 3;
  // Descriptive metadata for the script.
  ScriptMetadata metadata = 4;
}

// PrivateInfo defines the private information for a script.
message PrivateInfo {
  // The main plot of the script.
  int32 main_plot_id = 1;
  // A list of sub plots for the script.
  repeated int32 sub_plots_ids = 2;
  // A map of characters in the script.
  repeated int32 characters_ids = 3;
  // A map of incidents in the script.
  repeated int32 incident_ids = 4;
  // A map of character to role assignments, derived from the selected plots.
  map<int32, int32> role_assignments = 5;
}


// PublicInfo defines the public information for a script.
message PublicInfo {
  // The unique identifier for the script configuration.
  int32 script_config_id = 1 [ (validate.rules).int32.gt = 0 ];

  // Game rules.
  // The number of loops in the game.
  int32 loop_count = 2 [ (validate.rules).int32.gt = 0 ];
  // The number of days per loop.
  int32 days_per_loop = 3 [ (validate.rules).int32.gt = 0 ];
  // Whether players can discuss information.
  bool can_discuss = 4;

  // Special rules.
  // A map of special incidents.
  repeated int32 special_incident_ids = 5;
  // A map of scheduled incidents.
  repeated int32 scheduled_incident_ids = 6;
}

// RoleConfig defines the configuration for a role.
message RoleConfig {
  // The unique identifier for the role.
  int32 id = 1 [ (validate.rules).int32.gt = 0 ];
  // The name of the role.
  string name = 2 [ (validate.rules).string.min_len = 1 ];
  // The limit of characters that can have this role.
  int32 limit = 3 [ (validate.rules).int32.gte = 1 ];
  // A map of abilities for this role.
  map<int32, AbilityConfig> abilities = 4;
  // Defines the character's goodwill status.
  GoodwillRuleType goodwill_rule = 5;
  // Defines if the character can be made invincible.
  bool can_be_invincible = 6;
}

// PlotConfig defines a story plot.
message PlotConfig {
  // The unique identifier for the plot.
  int32 id = 1 [ (validate.rules).int32.gt = 0 ];
  // The type of the plot.
  PlotType type = 2;
  // The name of the plot.
  string name = 3 [ (validate.rules).string.min_len = 1 ];
  // A description of the plot.
  string description = 4;
  // A map of incident identifiers for this plot.
  map<int32, IncidentConfig> incident_ids = 5;
  // A map of role assignments for this plot.
  map<int32, int32> role_assignments = 6;
}