syntax = "proto3";

package proto.v1;

import "proto/v1/ability.proto";
import "proto/v1/enums.proto";
import "proto/v1/location.proto";

option go_package = "github.com/user/repo/proto/model";

// Enum for the type of attribute to check
enum Stat {
  STAT_UNSPECIFIED = 0;
  STAT_PARANOIA = 1;
  STAT_GOODWILL = 2;
  STAT_INTRIGUE = 3;
}

// Enum for the comparison operator
enum Operator {
  OPERATOR_UNSPECIFIED = 0;
  OPERATOR_GREATER_THAN = 1;
  OPERATOR_LESS_THAN = 2;
  OPERATOR_EQUAL_TO = 3;
  OPERATOR_GREATER_THAN_OR_EQUAL_TO = 4;
  OPERATOR_LESS_THAN_OR_EQUAL_TO = 5;
}

// TragedyCondition 定义悲剧发生的条件。
message TragedyCondition {
  TragedyType tragedy_type = 1; // 悲剧类型
  int32 day = 2; // 悲剧可能发生的日期
  string culprit_id = 3; // 嫌疑人ID
  repeated Condition conditions = 4; // 必须满足的条件列表
  TargetRuleType target_rule = 5; // 目标规则
  repeated Ability abilities = 6; // 悲剧发生时触发的能力
  bool is_active = 7; // 运行时状态：此悲剧当前是否在剧本中活跃？
  bool is_prevented = 8; // 运行时状态：此悲剧是否已被阻止？
}

// Condition 定义悲剧的一个单一条件。
message Condition {
  oneof condition_type {
    StatCondition stat_condition = 1;
    LocationCondition location_condition = 2;
  }
}

message StatCondition {
  string character_id = 1;
  Stat stat = 2;
  Operator operator = 3;
  int32 value = 4;
}

message LocationCondition {
  string character_id = 1;
  LocationType location = 2;
  bool is_alone = 3; // 是否独处
}

message Tragedy {
  string name = 1;
  string culprit = 2;
  repeated TragedyCondition conditions = 3;
}
